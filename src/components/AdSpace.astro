---
export interface Props {
  size: 'banner' | 'sidebar' | 'square' | 'mobile';
  position?: string;
  slot?: string;
}

const { size, position = '', slot } = Astro.props;

const adSizes = {
  banner: { width: '728', height: '90', slot: slot || '1234567890' },
  sidebar: { width: '300', height: '250', slot: slot || '2345678901' },
  square: { width: '250', height: '250', slot: slot || '3456789012' },
  mobile: { width: '320', height: '50', slot: slot || '4567890123' }
};

const currentSize = adSizes[size];
---

<div class={`ad-space ad-${size} ${position}`} style={`width: ${currentSize.width}px; height: ${currentSize.height}px;`}>
  <ins class="adsbygoogle"
       style={`display:inline-block;width:${currentSize.width}px;height:${currentSize.height}px`}
       data-ad-client="ca-pub-8812485670771278"
       data-ad-slot={currentSize.slot}
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
</div>

<style>
  .ad-space {
    margin: 20px auto;
    border-radius: 10px;
    position: relative;
    overflow: hidden;
    background: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .adsbygoogle {
    background: transparent;
  }

  /* Specific styles for different ad sizes */
  .ad-banner {
    max-width: 100%;
    margin: 30px auto;
  }

  .ad-sidebar {
    margin: 20px 0;
  }

  .ad-square {
    margin: 15px auto;
  }

  .ad-mobile {
    display: none;
    margin: 15px auto;
  }

  /* Responsive behavior */
  @media screen and (max-width: 768px) {
    .ad-banner {
      display: none;
    }

    .ad-mobile {
      display: block;
    }

    .ad-sidebar {
      width: 100% !important;
      max-width: 300px;
      margin: 20px auto;
    }

    .ad-square {
      width: 100% !important;
      max-width: 250px;
    }
  }

  /* Position-specific styles */
  .top {
    margin-top: 20px;
    margin-bottom: 40px;
  }

  .bottom {
    margin-top: 40px;
    margin-bottom: 20px;
  }

  .sticky-sidebar {
    position: sticky;
    top: 100px;
  }

  /* Loading state */
  .ad-space:empty::before {
    content: "Cargando anuncio...";
    color: #7f8c8d;
    font-size: 14px;
    opacity: 0.7;
  }
</style>

<script>
  // Initialize AdSense ads
  document.addEventListener('DOMContentLoaded', function() {
    try {
      (adsbygoogle = window.adsbygoogle || []).push({});
    } catch (e) {
      console.log('AdSense not loaded yet');
    }
  });

  // Push ads when component loads
  if (typeof window !== 'undefined') {
    window.addEventListener('load', function() {
      try {
        const ads = document.querySelectorAll('.adsbygoogle');
        ads.forEach(ad => {
          if (!ad.dataset.adsbygoogleStatus) {
            (adsbygoogle = window.adsbygoogle || []).push({});
          }
        });
      } catch (e) {
        console.log('AdSense initialization error:', e);
      }
    });
  }
</script>